{
  "variants": [
    {
      "id": "baseline",
      "description": "Current production prompt",
      "modifications": {}
    },
    {
      "id": "decorator-patterns",
      "description": "Add decorator examples for temporal correlation analysis (virtual threads, GC, safepoints, locks, I/O)",
      "modifications": {
        "customExamples": "CORE QUERY EXAMPLES:\n\nQ: \"top allocating classes\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | groupBy(objectClass/name, agg=sum, value=weight) | top(10, by=sum)\", \"explanation\": \"Groups allocations by class\", \"confidence\": 0.95}\n\nQ: \"which monitors have the most contention\"\nA: {\"query\": \"events/jdk.JavaMonitorEnter | groupBy(monitorClass/name) | top(10, by=count)\", \"explanation\": \"Groups monitor enter events by class\", \"confidence\": 0.95}\n\nQ: \"show file reads over 1MB\"\nA: {\"query\": \"events/jdk.FileRead[bytes>1048576]\", \"explanation\": \"Filters file reads\", \"confidence\": 0.98}\n\nQ: \"count GC events\"\nA: {\"query\": \"events/jdk.GarbageCollection | count()\", \"explanation\": \"Counts GC events\", \"confidence\": 0.98}\n\nDECORATOR QUERY EXAMPLES:\n\nQ: \"which methods are causing virtual thread pinning\"\nA: {\"query\": \"events/jdk.ExecutionSample | decorateByTime(jdk.VirtualThreadPinned, fields=duration) | groupBy(stackTrace/frames/0/method/type/name, agg=sum, value=$decorator.duration) | top(10, by=sum)\", \"explanation\": \"Correlates execution samples with pinning events using decorateByTime, groups by method and sums decorator duration field\", \"confidence\": 0.90}\n\nQ: \"which code allocates memory during garbage collection\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | decorateByTime(jdk.GCPhase, fields=name) | groupBy($decorator.name, agg=sum, value=allocationSize)\", \"explanation\": \"Decorates allocations with GC phase names using temporal overlap\", \"confidence\": 0.90}\n\nQ: \"what was the application doing during long safepoint pauses\"\nA: {\"query\": \"events/jdk.ExecutionSample | decorateByTime(jdk.SafepointBegin, fields=operation,duration) | groupBy($decorator.operation, agg=avg, value=$decorator.duration)\", \"explanation\": \"Correlates execution samples with safepoints\", \"confidence\": 0.90}\n\nQ: \"which monitors have cascading wait queues\"\nA: {\"query\": \"events/jdk.JavaMonitorWait | groupBy(monitorClass/name, agg=sum, value=duration) | top(10, by=sum)\", \"explanation\": \"Groups monitor waits by class and sums wait duration\", \"confidence\": 0.95}\n\nQ: \"which threads are blocked on I/O operations the most\"\nA: {\"query\": \"events/jdk.ThreadPark | decorateByTime(jdk.FileRead, fields=path) | groupBy(eventThread/javaName, agg=sum, value=duration) | top(10, by=sum)\", \"explanation\": \"Decorates thread park events with file read context\", \"confidence\": 0.90}\n\nQ: \"correlate monitor inflation events with contention\"\nA: {\"query\": \"events/jdk.JavaMonitorEnter | decorateByTime(jdk.JavaMonitorInflate, fields=monitorClass) | groupBy($decorator.monitorClass, agg=count)\", \"explanation\": \"Uses decorateByTime to join monitor events temporally\", \"confidence\": 0.90}\n\nQ: \"show pinned thread stack traces with duration over 100ms\"\nA: {\"query\": \"events/jdk.VirtualThreadPinned[duration>100000000]\", \"explanation\": \"Filters pinned thread events by duration\", \"confidence\": 0.95}\n\nQ: \"show allocation hot spots during young generation GC\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | decorateByTime(jdk.GarbageCollection, fields=gcId,name) | groupBy(objectClass/name, agg=sum, value=bytes) | top(10, by=sum)\", \"explanation\": \"Decorates allocations with GC events including name field\", \"confidence\": 0.90}\n\nQ: \"which threads allocate the most during GC phases\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | decorateByTime(jdk.GCPhase, fields=name) | groupBy(eventThread/javaName, agg=sum, value=bytes) | top(10, by=sum)\", \"explanation\": \"Decorates allocations with GC phases and groups by thread\", \"confidence\": 0.90}\n\nQ: \"find operations causing safepoint delays over 50ms\"\nA: {\"query\": \"events/jdk.SafepointBegin[duration>50000000] | groupBy(operation, agg=count)\", \"explanation\": \"Filters safepoints and groups by operation type\", \"confidence\": 0.95}\n\nQ: \"correlate JIT compilation with safepoint duration\"\nA: {\"query\": \"events/jdk.SafepointBegin | decorateByTime(jdk.Compilation, fields=method) | groupBy($decorator.method, agg=sum, value=duration)\", \"explanation\": \"Decorates safepoints with compilation method field\", \"confidence\": 0.90}\n\nQ: \"show thread starvation caused by lock contention\"\nA: {\"query\": \"events/jdk.JavaMonitorEnter[duration>100000000] | groupBy(eventThread/javaName, agg=count)\", \"explanation\": \"Filters long monitor enter events and groups by thread\", \"confidence\": 0.95}\n\nQ: \"correlate socket reads with thread parking duration\"\nA: {\"query\": \"events/jdk.SocketRead | decorateByTime(jdk.ThreadPark, fields=duration) | groupBy(address, agg=avg, value=$decorator.duration)\", \"explanation\": \"Decorates socket reads with thread park duration\", \"confidence\": 0.90}\n\nQ: \"detect blocking I/O causing thread starvation\"\nA: {\"query\": \"events/jdk.ThreadPark[duration>10000000] | decorateByTime(jdk.SocketRead, fields=bytesRead) | groupBy(eventThread/javaName, agg=count)\", \"explanation\": \"Filters long thread parks and decorates with socket read context\", \"confidence\": 0.90}\n\nCRITICAL DECORATOR SYNTAX RULES:\n\n1. Syntax: decorateByTime(EventType, fields=field1,field2) - fields parameter REQUIRED\n2. Decorator field access: MUST use $decorator.fieldName ($ prefix is REQUIRED)\n3. Decorator fields work in: groupBy keys, agg values, top sorting\n4. decorateByTime joins events that overlap in time on same thread\n5. DO NOT use filters inside decorateByTime - filter the primary events instead\n6. Examples: $decorator.duration, $decorator.name, $decorator.monitorClass\n\nCOMMON MISTAKES TO AVOID:\n\nWRONG: decorateByTime(jdk.Type) - missing fields parameter\nCORRECT: decorateByTime(jdk.Type, fields=field1)\n\nWRONG: groupBy(decorator.name) - missing $ prefix\nCORRECT: groupBy($decorator.name)\n\nWRONG: decorate(jdk.Type, fields=...) - wrong operator name\nCORRECT: decorateByTime(jdk.Type, fields=...)\n\nWRONG: decorateByTime(jdk.Type[filter], fields=...) - filters not supported inside decorateByTime\nCORRECT: events/jdk.PrimaryType[filter] | decorateByTime(jdk.Type, fields=...)\n\nKEY FIELD RULES:\n- ExecutionSample: Use 'sampledThread/javaName' for thread field\n- ObjectAllocationSample: Use 'eventThread/javaName', 'bytes' for memory, 'weight' for pressure\n- Virtual threads: jdk.VirtualThreadPinned event type for Java 21+\n- GC phases: jdk.GCPhase for phase-level analysis\n- Safepoints: jdk.SafepointBegin with 'operation' field\n- Network: jdk.SocketRead/SocketWrite with bytesRead/bytesWritten\n- File I/O: jdk.FileRead (bytes), jdk.FileWrite (bytesWritten)"
      }
    },
    {
      "id": "decorator-targeted",
      "description": "Concise fixes for 15 remaining failures: when NOT to use decorators, field names, aggregations, decorator usage",
      "modifications": {
        "customExamples": "DECORATOR EXAMPLES:\n\nQ: \"which methods are causing virtual thread pinning\"\nA: {\"query\": \"events/jdk.ExecutionSample | decorateByTime(jdk.VirtualThreadPinned, fields=duration) | groupBy(stackTrace/frames/0/method/type/name, agg=sum, value=$decorator.duration) | top(10, by=sum)\", \"explanation\": \"Correlates methods with pinning\", \"confidence\": 0.90}\n\nQ: \"which code allocates memory during garbage collection\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | decorateByTime(jdk.GCPhase, fields=name) | groupBy($decorator.name, agg=sum, value=allocationSize)\", \"explanation\": \"Allocations DURING GC phases\", \"confidence\": 0.90}\n\nQ: \"which monitors cause the most pinning events\"\nA: {\"query\": \"events/jdk.VirtualThreadPinned | decorateByTime(jdk.JavaMonitorEnter, fields=monitorClass) | groupBy($decorator.monitorClass, agg=count)\", \"explanation\": \"Monitors CAUSING pinning - needs decorator\", \"confidence\": 0.90}\n\nQ: \"correlate thread pinning with execution samples\"\nA: {\"query\": \"events/jdk.ExecutionSample | decorateByTime(jdk.VirtualThreadPinned, fields=duration,stackTrace) | groupBy($decorator.stackTrace/frames/0/method/type/name, agg=count)\", \"explanation\": \"Correlate means count occurrences, not sum duration\", \"confidence\": 0.90}\n\nQ: \"find allocation storms triggering emergency GC\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | decorateByTime(jdk.GarbageCollection, fields=gcId,name,cause) | groupBy($decorator.gcId, agg=count)\", \"explanation\": \"Group by gcId to count allocations per GC\", \"confidence\": 0.90}\n\nQ: \"what was the application doing during long safepoint pauses\"\nA: {\"query\": \"events/jdk.ExecutionSample | decorateByTime(jdk.SafepointBegin, fields=operation,duration) | groupBy($decorator.operation, agg=avg, value=$decorator.duration)\", \"explanation\": \"Primary=ExecutionSample (activity), Decorator=SafepointBegin (context)\", \"confidence\": 0.90}\n\nNO DECORATOR NEEDED:\n\nQ: \"what are top 5 hottest methods\"\nA: {\"query\": \"events/jdk.ExecutionSample/stackTrace/frames/0/method/type/name | groupBy(value) | top(5, by=count)\", \"explanation\": \"Simple hotspot query - NO decorator\", \"confidence\": 0.95}\n\nQ: \"which threads allocated the most memory\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | groupBy(eventThread/javaName, agg=sum, value=bytes) | top(10, by=sum)\", \"explanation\": \"Simple aggregation - NO decorator\", \"confidence\": 0.95}\n\nQ: \"top threads by virtual thread pinning duration\"\nA: {\"query\": \"events/jdk.VirtualThreadPinned | groupBy(eventThread/javaName, agg=sum, value=duration) | top(10, by=sum)\", \"explanation\": \"Direct aggregation of pinning events - NO decorator\", \"confidence\": 0.95}\n\nQ: \"threads with longest park times\"\nA: {\"query\": \"events/jdk.ThreadPark | groupBy(eventThread/javaName, agg=sum, value=duration) | top(10, by=sum)\", \"explanation\": \"MUST use agg=sum, value=duration before top()\", \"confidence\": 0.95}\n\nFIELD NAME PRECISION:\n\nQ: \"network reads larger than 1KB\"\nA: {\"query\": \"events/jdk.SocketRead[bytesRead>1024]\", \"explanation\": \"SocketRead uses bytesRead field, 1KB=1024 bytes\", \"confidence\": 0.95}\n\nQ: \"file writes over 5MB\"\nA: {\"query\": \"events/jdk.FileWrite[bytesWritten>5242880]\", \"explanation\": \"FileWrite uses bytesWritten (NOT bytes)\", \"confidence\": 0.95}\n\nQ: \"which classes took longest to load\"\nA: {\"query\": \"events/jdk.ClassLoad | groupBy(loadedClass/name, agg=max, value=duration) | top(10, by=max)\", \"explanation\": \"Field is loadedClass/name (NOT classname), use agg=max for longest\", \"confidence\": 0.95}\n\nQ: \"statistics on object allocation sizes\"\nA: {\"query\": \"events/jdk.ObjectAllocationSample | stats(weight)\", \"explanation\": \"Field is weight (NOT allocationSize)\", \"confidence\": 0.95}\n\nQ: \"count exceptions by type\"\nA: {\"query\": \"events/jdk.JavaExceptionThrow | groupBy(thrownClass/name)\", \"explanation\": \"Event is JavaExceptionThrow (NOT ExceptionStatistics)\", \"confidence\": 0.95}\n\nAGGREGATION RULES:\n\nQ: \"network traffic by remote address\"\nA: {\"query\": \"events/jdk.SocketRead | groupBy(address, agg=sum, value=bytesRead)\", \"explanation\": \"Traffic = sum bytes, MUST specify agg=sum, value=bytesRead\", \"confidence\": 0.95}\n\nQ: \"GC events in young generation longer than 50ms\"\nA: {\"query\": \"events/jdk.GarbageCollection[name=~\\\".*Young.*\\\"][duration>50000000]\", \"explanation\": \"Use regex [name=~\\\".*Young.*\\\"] and duration filter [duration>50000000]\", \"confidence\": 0.90}\n\nCRITICAL RULES:\n\n1. NO DECORATOR for simple queries:\n   - \"top X\", \"which threads\", \"hottest methods\" = NO decorator\n   - ONLY use decorator for: \"during\", \"causing\", \"correlate\", \"while\"\n\n2. FIELD NAMES:\n   - FileRead: bytes\n   - FileWrite: bytesWritten\n   - SocketRead/SocketWrite: bytesRead/bytesWritten\n   - ObjectAllocationSample: bytes (memory), weight (allocation pressure)\n   - ClassLoad: loadedClass/name\n   - JavaExceptionThrow: thrownClass/name\n   - ExecutionSample: sampledThread/javaName\n   - Everything else: eventThread/javaName\n\n3. AGGREGATION:\n   - For \"longest/most time\": agg=sum, value=duration THEN top(N, by=sum)\n   - For \"traffic/total bytes\": agg=sum, value=bytes THEN top(N, by=sum)\n   - NEVER: top(N, by=duration) - must use agg=sum first\n\n4. DECORATOR SEMANTICS:\n   - \"correlate X with Y\" = count occurrences (agg=count), NOT sum duration\n   - \"X causing Y\" = primary is Y, decorator is X\n   - \"during X\" = primary is the activity, decorator is the context (X)\n   - \"storms triggering GC\" = group by $decorator.gcId to count per GC\n\n5. EVENT TYPES:\n   - Exceptions: jdk.JavaExceptionThrow (NOT ExceptionStatistics)\n   - Virtual threads: jdk.VirtualThreadPinned (NOT VMThreadPinning)\n   - Thread parking: jdk.ThreadPark (NOT ThreadWait)\n   - Monitors: jdk.JavaMonitorEnter/Wait/Inflate (NOT LockContended)\n\nINCORRECT EXAMPLES:\n\nQ: \"what are top 5 hottest methods\"\nWRONG: events/jdk.ExecutionSample | decorateByTime(jdk.MethodInvoke, fields=name) | ...\nCORRECT: events/jdk.ExecutionSample/stackTrace/frames/0/method/type/name | groupBy(value) | top(5, by=count)\n\nQ: \"which threads allocated the most memory\"\nWRONG: events/jdk.ObjectAllocationSample | decorateByTime(jdk.GCPhase, fields=name) | groupBy(eventThread/javaName, agg=sum, value=bytes) | top(10, by=sum)\nCORRECT: events/jdk.ObjectAllocationSample | groupBy(eventThread/javaName, agg=sum, value=bytes) | top(10, by=sum)\n\nQ: \"network reads larger than 1KB\"\nWRONG: events/jdk.SocketRead[bytes>1048576]\nCORRECT: events/jdk.SocketRead[bytesRead>1024]\n\nQ: \"threads with longest park times\"\nWRONG: events/jdk.ThreadPark | groupBy(eventThread/javaName) | top(10, by=duration)\nCORRECT: events/jdk.ThreadPark | groupBy(eventThread/javaName, agg=sum, value=duration) | top(10, by=sum)\n\nQ: \"count exceptions by type\"\nWRONG: events/jdk.ExceptionStatistics | groupBy(type/name) | count()\nCORRECT: events/jdk.JavaExceptionThrow | groupBy(thrownClass/name)\n\nQ: \"top threads by virtual thread pinning duration\"\nWRONG: events/jdk.ExecutionSample | decorateByTime(jdk.VirtualThreadPinned, fields=duration) | groupBy(stackTrace/frames/0/method/type/name, agg=sum, value=$decorator.duration) | top(10, by=sum)\nCORRECT: events/jdk.VirtualThreadPinned | groupBy(eventThread/javaName, agg=sum, value=duration) | top(10, by=sum)\n\nQ: \"which monitors cause the most pinning events\"\nWRONG: events/jdk.JavaMonitorEnter | groupBy(monitorClass/name) | top(10, by=count)\nCORRECT: events/jdk.VirtualThreadPinned | decorateByTime(jdk.JavaMonitorEnter, fields=monitorClass) | groupBy($decorator.monitorClass, agg=count)\n\nQ: \"correlate thread pinning with execution samples\"\nWRONG: events/jdk.ExecutionSample | decorateByTime(jdk.VirtualThreadPinned, fields=duration) | groupBy(stackTrace/frames/0/method/type/name, agg=sum, value=$decorator.duration) | top(10, by=sum)\nCORRECT: events/jdk.ExecutionSample | decorateByTime(jdk.VirtualThreadPinned, fields=duration,stackTrace) | groupBy($decorator.stackTrace/frames/0/method/type/name, agg=count)\n\nQ: \"what was the application doing during long safepoint pauses\"\nWRONG: events/jdk.SafepointBegin | decorateByTime(jdk.ExecutionSample, fields=operation,duration) | groupBy($decorator.operation, agg=avg, value=$decorator.duration)\nCORRECT: events/jdk.ExecutionSample | decorateByTime(jdk.SafepointBegin, fields=operation,duration) | groupBy($decorator.operation, agg=avg, value=$decorator.duration)"
      }
    }
  ]
}
